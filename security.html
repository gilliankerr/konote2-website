<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="How KoNote protects participant data: encryption, access control, audit logging, and compliance features.">
  <title>Security & Privacy — KoNote</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" href="favicon.ico" sizes="32x32">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16.png">
</head>
<body>
  <a href="#main" class="skip-nav">Skip to main content</a>

  <header class="site-header">
    <div class="container header-inner">
      <a href="index.html" class="site-logo"><img src="img/konote-logo.png" alt="KoNote" width="166" height="32"></a>
      <button class="nav-toggle" aria-expanded="false" aria-controls="main-nav">
        Menu
      </button>
      <nav class="site-nav" id="main-nav" aria-label="Main navigation">
        <a href="index.html">Home</a>
        <a href="features.html">Features</a>
        <a href="evidence.html">Evidence</a>
        <a href="getting-started.html">Getting Started</a>
        <a href="documentation.html">Documentation</a>
        <a href="security.html" aria-current="page">Security</a>
        <a href="services.html">Services</a>
        <a href="faq.html">FAQ</a>
      </nav>
    </div>
  </header>

  <main id="main">
    <section class="hero">
      <div class="container">
        <h1>Security & Privacy</h1>
        <p class="hero-tagline">
          How KoNote protects participant data — and what you're responsible for.
        </p>
      </div>
    </section>

    <section>
      <div class="container content-width">
        <div class="disclaimer">
          <p class="disclaimer-title">Shared Responsibility</p>
          <p>
            KoNote provides security features, but security is a shared responsibility.
            The software can only protect data if you configure and operate it correctly.
            This page explains both what KoNote does and what you must do.
          </p>
        </div>
      </div>
    </section>

    <section class="alt-bg">
      <div class="container">
        <h2>What KoNote Does</h2>

        <div class="card-grid">
          <div class="card">
            <h3>Field-Level Encryption</h3>
            <p>
              All personally identifiable information (PII) is encrypted before
              being stored in the database.
            </p>
            <ul>
              <li><strong>Algorithm:</strong> Fernet (AES-128-CBC + HMAC-SHA256)</li>
              <li><strong>Encrypted fields:</strong> Participant names, birth dates, emails, phone numbers, sensitive custom fields</li>
              <li><strong>Key storage:</strong> Your encryption key, stored as an environment variable</li>
              <li><strong>Key rotation:</strong> Built-in key rotation command for changing encryption keys</li>
            </ul>
            <p class="text-muted">
              Even if someone gains access to the database, encrypted fields
              are unreadable without the encryption key.
            </p>
          </div>

          <div class="card">
            <h3>Dual-Database Architecture</h3>
            <p>
              KoNote uses two separate PostgreSQL databases.
            </p>
            <ul>
              <li><strong>Operational database:</strong> Participant records, notes, plans (normal CRUD operations)</li>
              <li><strong>Audit database:</strong> Immutable log of all data access and changes (INSERT-only)</li>
            </ul>
            <p class="text-muted">
              The audit database cannot be modified or deleted through the application,
              providing a tamper-resistant record.
            </p>
          </div>

          <div class="card">
            <h3>Role-Based Access Control</h3>
            <p>
              Five roles with different permissions, enforced at the middleware level.
            </p>
            <ul>
              <li><strong>Administrator:</strong> System configuration (no direct participant access)</li>
              <li><strong>Program Manager:</strong> Full access to their programs' participants and staff</li>
              <li><strong>Direct Service:</strong> Access to participants in their assigned programs</li>
              <li><strong>Front Desk:</strong> Limited access to specific fields only</li>
              <li><strong>Executive:</strong> Dashboard and reporting access</li>
            </ul>
            <p class="text-muted">
              Staff can only see participants enrolled in programs they're assigned to.
              Admins are deliberately blocked from participant data.
            </p>
          </div>

          <div class="card">
            <h3>Complete Audit Logging</h3>
            <p>
              Every significant action is logged with full context.
            </p>
            <ul>
              <li><strong>Data changes:</strong> Create, update, delete with before/after values</li>
              <li><strong>Data access:</strong> Who viewed which participant record and when</li>
              <li><strong>Authentication:</strong> Login, logout, failed login attempts</li>
              <li><strong>Metadata:</strong> Timestamp, user ID, IP address</li>
            </ul>
            <p class="text-muted">
              Logs are searchable through the admin interface and can be exported.
            </p>
          </div>

          <div class="card">
            <h3>Secure Authentication</h3>
            <p>
              Two authentication options, both using modern security practices.
            </p>
            <ul>
              <li><strong>Azure AD SSO:</strong> Integrate with your organisation's Microsoft 365</li>
              <li><strong>Local authentication:</strong> Passwords hashed with Argon2 (winner of the Password Hashing Competition)</li>
            </ul>
            <p class="text-muted">
              Session tokens are stored in the database with configurable timeouts.
            </p>
          </div>

          <div class="card">
            <h3>Secure Data Exports</h3>
            <p>
              Defence-in-depth controls on data exports to prevent unauthorised data extraction.
            </p>
            <ul>
              <li><strong>Time-limited links:</strong> Export downloads expire after 24 hours</li>
              <li><strong>Elevated exports:</strong> Large exports (100+ participants) or exports containing notes trigger admin notification and a 10-minute delay</li>
              <li><strong>Admin oversight:</strong> Admins can revoke export links before they expire</li>
              <li><strong>Download tracking:</strong> Every download is logged (who, when, how many times)</li>
              <li><strong>Re-validation:</strong> PII access permissions are re-checked at download time</li>
            </ul>
          </div>

          <div class="card">
            <h3>Security Headers</h3>
            <p>
              HTTP security headers configured by default.
            </p>
            <ul>
              <li>Content Security Policy (CSP)</li>
              <li>HTTP Strict Transport Security (HSTS)</li>
              <li>X-Frame-Options (clickjacking protection)</li>
              <li>X-Content-Type-Options</li>
              <li>CSRF protection on all forms</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <section>
      <div class="container">
        <h2>What You Must Do</h2>
        <p class="text-muted mb-8">
          KoNote's security features only work if you fulfil your responsibilities.
          These are not optional.
        </p>

        <div class="card-grid">
          <div class="card">
            <h3>Protect Your Encryption Key</h3>
            <p>
              <strong>If you lose the encryption key, you lose access to all encrypted data permanently.</strong>
            </p>
            <ul>
              <li>Store the key securely (password manager, secure vault)</li>
              <li>Keep offline backups in secure locations</li>
              <li>Never commit the key to version control</li>
              <li>Limit who knows the key to essential personnel</li>
            </ul>
            <div class="notice notice-warning mb-0">
              <p>There is no "forgot password" for encryption keys. Lost key = lost data.</p>
            </div>
          </div>

          <div class="card">
            <h3>Configure HTTPS</h3>
            <p>
              All production deployments must use HTTPS. Without it, data
              (including login credentials) can be intercepted.
            </p>
            <ul>
              <li>Railway and Elestio provide automatic HTTPS</li>
              <li>Azure requires configuration</li>
              <li>Self-hosted requires a reverse proxy (Caddy, nginx) with certificates</li>
            </ul>
            <div class="notice notice-warning mb-0">
              <p>Never run KoNote over plain HTTP in production.</p>
            </div>
          </div>

          <div class="card">
            <h3>Maintain Regular Backups</h3>
            <p>
              You are responsible for backing up both databases and verifying
              that backups can be restored.
            </p>
            <ul>
              <li>Automated daily backups (minimum)</li>
              <li>Store backups in a separate location from the primary database</li>
              <li>Test restores regularly (at least quarterly)</li>
              <li>Keep backups encrypted and access-controlled</li>
            </ul>
            <div class="notice notice-warning mb-0">
              <p>If you don't have backups and something goes wrong, the data is gone.</p>
            </div>
          </div>

          <div class="card">
            <h3>Control User Access</h3>
            <p>
              KoNote provides the tools; you must use them correctly.
            </p>
            <ul>
              <li>Only create accounts for people who need access</li>
              <li>Assign the minimum role needed for each user's job</li>
              <li>Remove accounts promptly when staff leave</li>
              <li>Review user access regularly</li>
            </ul>
          </div>

          <div class="card">
            <h3>Keep Software Updated</h3>
            <p>
              Security vulnerabilities are discovered over time. Updates address them.
            </p>
            <ul>
              <li>Monitor the GitHub repository for releases</li>
              <li>Apply updates promptly, especially security patches</li>
              <li>Test updates in a staging environment if possible</li>
            </ul>
          </div>

          <div class="card">
            <h3>Train Your Staff</h3>
            <p>
              Technical security is only part of the picture.
            </p>
            <ul>
              <li>Train staff on acceptable use and data handling</li>
              <li>Establish policies for sharing information</li>
              <li>Create procedures for security incidents</li>
              <li>Document your organisation's privacy practices</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <section class="alt-bg">
      <div class="container content-width">
        <h2>Compliance Features</h2>

        <div class="card">
          <h3>PIPEDA Readiness</h3>
          <p>
            KoNote includes features to support compliance with Canada's
            Personal Information Protection and Electronic Documents Act.
          </p>
          <ul>
            <li>Encryption of personal information</li>
            <li>Access controls and audit logging</li>
            <li>Consent tracking fields</li>
            <li>Data retention configuration</li>
            <li>Multi-stage data erasure workflow with approval chain</li>
            <li>Privacy policy template</li>
          </ul>
          <p class="text-muted">
            <strong>Note:</strong> Using KoNote doesn't automatically make you PIPEDA-compliant.
            Compliance depends on how you configure and operate the system,
            your policies, and your staff practices.
          </p>
        </div>

        <div class="card">
          <h3>GDPR Readiness</h3>
          <p>
            For organisations serving European participants, KoNote includes:
          </p>
          <ul>
            <li>Consent tracking (consent_given_at field)</li>
            <li>Data retention periods</li>
            <li>Multi-program-manager erasure approval workflow</li>
            <li>Automatic erasure execution when all approvals received</li>
            <li>Audit trail of data processing preserved after erasure</li>
          </ul>
          <p class="text-muted">
            <strong>Note:</strong> GDPR compliance requires more than software features.
            Consult with a privacy professional for your specific situation.
          </p>
        </div>

        <div class="card">
          <h3>Accessibility (WCAG 2.2 AA)</h3>
          <p>
            KoNote is built with accessibility in mind:
          </p>
          <ul>
            <li>Semantic HTML structure</li>
            <li>Keyboard navigation</li>
            <li>Sufficient colour contrast</li>
            <li>Screen reader compatibility</li>
            <li>Skip navigation links</li>
          </ul>
        </div>
      </div>
    </section>

    <section>
      <div class="container content-width">
        <h2>Security Limitations</h2>
        <p>
          Being honest about what KoNote cannot do:
        </p>

        <div class="card">
          <h3>No Encrypted Search</h3>
          <p>
            Encrypted fields cannot be searched using SQL queries. Participant search
            loads accessible participants into memory and filters in Python.
            This works well up to ~2,000 participants but may slow down at larger scales.
          </p>
        </div>

        <div class="card">
          <h3>Staff MFA via SSO Only</h3>
          <p>
            Staff local authentication doesn't include MFA. If you need staff MFA, use Azure AD SSO,
            which supports your organisation's MFA policies. The participant portal has
            built-in MFA (TOTP authenticator app or email verification codes).
          </p>
        </div>

        <div class="card">
          <h3>No Automatic Intrusion Detection</h3>
          <p>
            KoNote logs access but doesn't automatically alert on suspicious patterns.
            You need to review audit logs periodically or integrate with external
            monitoring tools.
          </p>
        </div>
      </div>
    </section>

    <section class="alt-bg">
      <div class="container text-center">
        <h2>Questions About Security?</h2>
        <p class="text-muted mb-8">
          The technical documentation has more detail on security implementation.
          For organisation-specific questions, consider professional consultation.
        </p>
        <div class="btn-group" style="justify-content: center;">
          <a href="documentation.html" class="btn btn-primary">Technical Documentation</a>
          <a href="services.html" class="btn btn-secondary">Professional Services</a>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-content">
      <div class="footer-links">
        <a href="https://github.com/LogicalOutcomes/konote">GitHub Repository</a>
        <a href="documentation.html">Documentation</a>
        <a href="faq.html">FAQ</a>
        <a href="services.html">Professional Services</a>
      </div>
      <p class="footer-copyright">
        KoNote is open source software under the MIT License.
      </p>
    </div>
  </footer>

  <script>
    const navToggle = document.querySelector('.nav-toggle');
    const nav = document.querySelector('.site-nav');
    if (navToggle && nav) {
      navToggle.addEventListener('click', () => {
        const isOpen = nav.classList.toggle('is-open');
        navToggle.setAttribute('aria-expanded', isOpen);
      });
    }
  </script>
</body>
</html>
